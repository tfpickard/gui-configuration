# This is hyprland config
# Exec {{{
$scriptsdir=~/.config/hypr/scripts
exec-once=systemctl --user import-environment XDG_SESSION_TYPE XDG_CURRENT_DESKTOP
exec-once=dbus-update-activation-environment --systemd WAYLAND_DISPLAY XDG_CURRENT_DESKTOP

exec-once=killall -q waybar;sleep .5 && waybar

exec-once=/usr/lib/xfce-polkit/xfce-polkit
exec-once=wl-paste --type text --watch cliphist store
exec-once=wl-paste --type image --watch cliphist store
exec-once=wl-paste --type application/pdf --watch cliphist store
exec-once=udiskie 
exec-once=/usr/lib/kdeconnectd
exec-once=kdeconnect-indicator
exec-once=mailspring --background
exec-once=rclone mount --daemon gdrive: ~/drive/gdrive 
exec-once=rclone mount --daemon gbudrive: ~/drive/gbudrive 
exec-once=rclone mount --daemon shared-gbu: ~/drive/shared-gbu 
exec-once=rclone mount --daemon gphotos: ~/drive/gphotos 
exec-once=~/bin/setwal -w ~/.wallpaper -s
exec-once=sleep 10s && corectrl 
exec-once=$scriptsdir/ipc
exec-once=waydroid session start

exec=killall -q libinput-gestures; libinput-gestures
exec=~/.config/hypr/init
exec=xrdb ~/.Xresources
exec=$scriptsdir/idle
exec=$scriptsdir/monitor
exec-once=~/.config/hypr/init-once

# exec-once=hyprctl plugin load ~/.config/hypr/plugins/hyprland-plugins/csgo-vulkan-fix/csgo-vulkan-fix.so

# exec-once=$scriptsdir/rule-clean
# }}}

# Environment variables{{{
# GTK variables
env = GTK_THEME,linea-nord-color
# env = GTK_THEME="Adw-dark:dark"
env = XCURSOR_SIZE,16
env = XCURSOR_THEME,GoogleDot-Black
# env = GTK_THEME="oomox-gtk-nik-theme"

# XDG
env = XDG_CURRENT_DESKTOP,Hyprland
env = XDG_SESSION_TYPE,wayland
env = XDG_SESSION_DESKTOP,Hyprland

# QT
env = QT_AUTO_SCREEN_SCALE_FACTOR,1
# env = QT_QPA_PLATFORM="wayland;xcb"    # Not yet working for onlyoffice-editor
env = QT_WAYLAND_DISABLE_WINDOWDECORATION,1
env = QT_QPA_PLATFORMTHEME,qt5ct

# Toolkit
env = SDL_VIDEODRIVER,wayland
env = _JAVA_AWT_WM_NONEREPARENTING,1
env = CLUTTER_BACKEND,wayland
env = GDK_BACKEND,wayland,x11

# Enabling firefox wayland
env = BROWSER,firefox
env = MOZ_ENABLE_WAYLAND,1
# env = EDITOR,nvim

# }}}

# Colors {{{
source=~/.config/hypr/colors.conf
# }}}

# {{{ bindings

# Submap {{{

# Passes the keymaps to windows disables global keymaps{{{
bind=SUPER,g,submap,Pass
submap=Pass
bind=,,pass,^(.*)$
bind=,escape,submap,reset 
bind=SUPER,SPACE,submap,reset 
submap=reset
# }}}

# Groups{{{
bind=SUPERCTRL,SPACE,exec,$scriptsdir/togglegroup

bind=ALT,h,changegroupactive,b
bind=ALT,l,changegroupactive,f

submap=Group
bind=,l,moveintogroup,r
bind=,h,moveintogroup,l
bind=,j,moveintogroup,d
bind=,k,moveintogroup,u

# Custom focus to handle windows on top in floating mode
bind=SUPER,h,exec,$scriptsdir/cusfocus l
bind=SUPER,l,exec,$scriptsdir/cusfocus r
bind=SUPER,k,exec,$scriptsdir/cusfocus u
bind=SUPER,j,exec,$scriptsdir/cusfocus d

bind=SHIFT,l,moveoutofgroup,r
bind=SHIFT,h,moveoutofgroup,l
bind=SHIFT,j,moveoutofgroup,d
bind=SHIFT,k,moveoutofgroup,u

bind=,e,exec,hyprctl --batch "dispatch submap reset; dispatch togglegroup";notify-send 'Exited Group' 

bind=,escape,submap,reset 
bind=SUPER,SPACE,submap,reset 
submap=reset
# }}}

# Rofi{{{
$rofi=killall rofi || rofi
# ========================== Rofi ========================== #
bind=ALT,SPACE,submap,Rofi
submap=Rofi
$submapreset=hyprctl dispatch submap reset
bind=,D,exec,$submapreset;$rofi -show drun -display-drun "[]= " -theme dmenu.rasi
bind=,V,exec,$submapreset;cliphist list | rofi -dmenu -i -p "clipboard" | cliphist decode | wl-copy;
# bind=,V,exec,$submapreset;cb st | jq -r '.[]' | rofi -dmenu u| wl-copy;
# bind=,period,exec,$submapreset;killall rofi || rofimoji -a type copy --selector-args="-config ~/.config/rofi/emoji-conf.rasi"
bind=,period,exec,$submapreset;$rofi -modi emoji -show emoji -kb-custom-1 Ctrl+y
bind=,slash,exec,$submapreset;$scriptsdir/bin/focus-clients
bind=SHIFT,slash,exec,$submapreset;$scriptsdir/bin/get-clients
bind=,SPACE,exec,$submapreset;$rofi -show drun -theme menu-full.rasi
bind=,A,exec,$submapreset;~/bin/pactl
bind=,N,exec,$submapreset;killall rofi || networkmanager_dmenu
bind=,B,exec,$submapreset;killall rofi || ~/bin/rofi-bluetooth -i -p "Bluetooth"
bind=,C,exec,$submapreset;$rofi -show calc -modi calc -no-show-match -no-sort
bind=,m,exec,$submapreset;~/bin/menu
bind=,k,exec,$submapreset;$scriptsdir/bin/hkill
bind=,escape,exec,hyprctl dispatch submap reset; killall rofi
bind=ALT,SPACE,exec,hyprctl dispatch submap reset; killall rofi
bind=SUPER,SPACE,exec,hyprctl dispatch submap reset; killall rofi
submap=reset
# }}}

# keybinds further down will be global again...
# }}}

# scratchpad layout keymaps {{{
bind=SUPER,comma,exec,scratchpad
bind=SUPERSHIFT,comma,exec,scratchpad -g
# }}}


# ========================== Mouse ========================== #
bindm=SUPER,mouse:272,movewindow
bindm=SUPER,mouse:273,resizewindow

# ========================== General ========================== #
bind=SUPER,Q,killactive,

bind=SUPER,s,togglesplit

binde=SUPER,equal,exec,~/.config/hypr/scripts/zoom 0.1
binde=SUPER,minus,exec,~/.config/hypr/scripts/zoom -0.1
bind=SUPERSHIFT,equal,exec,~/.config/hypr/scripts/zoom
bind=SUPERSHIFT,minus,exec,~/.config/hypr/scripts/zoom

bind=SUPER,M,exec,$scriptsdir/fullscreen
# bind=SUPERSHIFT,M,fullscreen

bind=SUPER,F,togglefloating,
bind=SUPERSHIFT,F,pseudo,

bind=SUPERSHIFT,x,exec,hyprctl kill

bind=SUPERSHIFT,A,pin,  # pins floating window

# Custom focus to handle windows on top in floating mode
bind=SUPER,h,exec,$scriptsdir/cusfocus l
bind=SUPER,l,exec,$scriptsdir/cusfocus r
bind=SUPER,k,exec,$scriptsdir/cusfocus u
bind=SUPER,j,exec,$scriptsdir/cusfocus d

binde=SUPERCTRL,h,resizeactive,-50 0
binde=SUPERCTRL,l,resizeactive,50 0
binde=SUPERCTRL,j,resizeactive,0 50
binde=SUPERCTRL,k,resizeactive,0 -50

binde=SUPERSHIFT,h,exec,$scriptsdir/cusmove l
binde=SUPERSHIFT,l,exec,$scriptsdir/cusmove r
binde=SUPERSHIFT,j,exec,$scriptsdir/cusmove d
binde=SUPERSHIFT,k,exec,$scriptsdir/cusmove u

# ========================== Workspaces ========================== #
bind=SUPER,mouse_down,workspace,e+1
bind=SUPER,mouse_up,workspace,e-1

bind=SUPER,1,workspace,1
bind=SUPER,2,workspace,2
bind=SUPER,3,workspace,3
bind=SUPER,4,workspace,4
bind=SUPER,5,workspace,5
bind=SUPER,6,workspace,6
bind=SUPER,7,workspace,7
bind=SUPER,8,workspace,8
bind=SUPER,9,workspace,9
# bind=SUPER,0,workspace,10

bind=SUPERSHIFT,1,movetoworkspace,1
bind=SUPERSHIFT,2,movetoworkspace,2
bind=SUPERSHIFT,3,movetoworkspace,3
bind=SUPERSHIFT,4,movetoworkspace,4
bind=SUPERSHIFT,5,movetoworkspace,5
bind=SUPERSHIFT,6,movetoworkspace,6
bind=SUPERSHIFT,7,movetoworkspace,7
bind=SUPERSHIFT,8,movetoworkspace,8
bind=SUPERSHIFT,9,movetoworkspace,9
bind=SUPERSHIFT,0,movetoworkspace,10

bind=SUPER,p,workspace,e-1
bind=SUPER,n,workspace,e+1

bind=SUPERSHIFT,p,movetoworkspace,e-1
bind=SUPERSHIFT,n,movetoworkspace,e+1
# bind=SHIFTALT,k,workspace,e-1
# bind=SHIFTALT,j,workspace,e+1



bind=SUPERCTRLSHIFT,f,workspaceopt,allfloat


bind=SUPERSHIFT,d,exec,~/.config/waybar/scripts/not-dnd

# ========================== Rofi General Keys ========================== #
bind=SUPER,D,exec,$rofi -show drun -display-drun "[]= " -theme dmenu.rasi
bind=SUPER,V,exec,$rofi -modi clipboard:/home/niksingh710/bin/cliphist-rofi -show clipboard
# bind=SUPER,period,exec,killall rofi || rofimoji -a type copy --selector-args="-config ~/.config/rofi/emoji-conf.rasi"
bind=SUPER,period,exec,$rofi -modi emoji -show emoji -kb-custom-1 Ctrl+y
bind=SUPER,slash,exec,killall rofi || rofi -show combi -modes combi -combi-modes "clients:~/.config/hypr/scripts/bin/f-clients,drun" -no-show-mode -combi-display-format '{text}'
bind=SUPERSHIFT,slash,exec,$scriptsdir/bin/get-clients

# ========================== Fn Keys ========================== #
bind=,XF86AudioMute,exec,~/bin/volume mute
bind=,XF86AudioMicMute,exec,pactl set-source-mute @DEFAULT_SOURCE@ toggle
bind=,XF86PowerOff,exec,systemctl suspend
bind=,XF86WebCam,exec,~/.config/waybar/scripts/camera-toggle

$tpadcmd=hyprctl keywords device:elan-touchpad
bind=,XF86TouchpadOn,exec,$tpadcmd:enabled true && $tpadcmd:natural_scroll true && notify-send "Touchpad: On"
bind=,XF86TouchpadOff,exec,$tpadcmd:enabled false && notify-send "Touchpad: Off"

binde=,XF86AudioRaiseVolume,exec,~/bin/volume up
binde=,XF86AudioLowerVolume,exec,~/bin/volume down

binde=,XF86MonBrightnessUp,exec,~/bin/brightness up
binde=,XF86MonBrightnessDown,exec,~/bin/brightness down

# bind=,XF86Search,exec,wtype


# ========================== Screenshots ========================== #
$sscommand=~/bin/grimblast --notify --cursor copysave 
$sspath=~/Pictures/Screenshots/"$(date +"ss-%d-%b-%C_%H-%M-%S")".png
$ssarea=hyprctl keyword animation "fadeOut,1,4,default"; $sscommand area $sspath; hyprctl keyword animation "fadeOut,1,4,default"

bind=,Print,exec,$sscommand output $sspath
bind=SUPERSHIFT,Print,exec,$ssarea
bind=SUPER,Print,exec,$sscommand active $sspath
bind=ALT,Print,exec,$sscommand screen $sspath


# ========================== Display ========================== #
bind=SUPER,SPACE,exec,hyprctl dispatch focusmonitor +1
bind=SUPERSHIFT,SPACE,exec,hyprctl dispatch movewindow mon:+1

bind=SUPERSHIFT,C,centerwindow,
bind=SUPERSHIFT,R,exec,~/bin/setwal
# bind=SUPERSHIFT,E,exec,wlogout -b 5 -p layer-shell -c 10px -r 10px -T 400px -B 400px
bind=SUPERSHIFT,E,exec,~/bin/powermenu
bind=SUPERCTRL,C,exec,~/.config/waybar/scripts/colpicker/colorpicker
bind=SUPER,R,exec,hyprctl reload
bind=,F9,exec,~/bin/lock
#
# bind=SUPERSHIFT,RETURN,exec,kitty
# bind=SUPERSHIFT,RETURN,exec,foot tmux new-session -A -s $USER
# bind=SUPERSHIFT,RETURN,exec,foot sh -c "zellij a --create nn"
bind=SUPERSHIFT,RETURN,exec,foot sh -c "zellij a --create $USER"
# bind=SUPERSHIFT,RETURN,exec,alacritty -e zellij a --create $USER

bind=SUPERSHIFT,S,exec,$scriptsdir/swallow-toggle

bind=SUPERSHIFT,V,exec,cliphist wipe

# }}}

# Window Rules {{{

layerrule = noanim, swww
layerrule = noanim, waybar

# windowrule=opacity 0.86,discord
windowrule=workspace 3,^(org.telegram.desktop)
windowrule=workspace 3,^(discord)$
windowrule=workspace 3,^(google-chat-linux)$
windowrule=workspace 3,^(whatsapp-for-linux)$
windowrule=workspace 3,^(tangram)$
windowrule=workspace 3,^(whatsapp)$

windowrule=workspace 4,^(mailspring)

windowrule=workspace 6,^(lutris)
windowrule=workspace 6,^(steam)
windowrule=workspace 6,^(gamescope)$

windowrule = float,^(xfce-polkit)$
windowrule = float,^(telegramdesktop)$
windowrule = float,^(telegram-desktop)$
windowrule = float,^(org.telegram.desktop)$
windowrule = float,^(discord)$
windowrule = float,^(tangram)$
windowrule = float,^(scrcpy)$
windowrule = float,^(feh)$
windowrule = float,^(Choose Files)$
windowrule = float,^(imv)$
windowrule = float,^(google-chat-linux)$
windowrule = float,^(whatsapp-for-linux)$

# Window rules
windowrule = float, iwgtk
windowrule = float,YouTube Music 
windowrule = float, file_progress
windowrule = float, Mailspring
windowrule = float, confirm
windowrule = float, dialog
windowrule = float, download
windowrule = float, notification
windowrule = float, error
windowrule = float, splash
windowrule = float, confirmreset
windowrule = float, title:Open File
windowrule = float, title:branchdialog
windowrule = float, zoom
windowrule = float, vlc
windowrule = float, Lxappearance
windowrule = float, ncmpcpp
windowrule = float, Rofi
windowrule = animation none, Rofi
windowrule = float, viewnior
windowrule = float, pavucontrol-qt
windowrule = float, pavucontrol-qt
windowrule = float, gucharmap
windowrule = float, gnome-font
windowrule = float, org.gnome.Settings
windowrule = float, file-roller
windowrule = float, nautilus
windowrule = float, nemo
windowrule = float, thunar
windowrule = float, Pcmanfm
windowrule = float, obs
windowrule = float, wdisplays
windowrule = float, zathura
windowrule = float, waydroid*
windowrule = float, *.exe
windowrule = fullscreen, wlogout
windowrule = float, title:wlogout
windowrule = float, title:New Vm
windowrule = float, mpv
windowrule = fullscreen, title:wlogout
windowrule = float, keepassxc
windowrule = float, title:^(Media viewer)$
windowrule = float, title:^(Transmission)$
windowrule = float, title:^(Volume Control)$
windowrule = float, title:^(Picture-in-Picture)$
windowrule = float, title:^(Firefox — Sharing Indicator)$
windowrule = move 0 0, title:^(Firefox — Sharing Indicator)$

windowrule = size 800 600, title:^(Volume Control)$
windowrule = move 75 44%, title:^(Volume Control)$

windowrule = idleinhibit focus, mpv
windowrule = idleinhibit fullscreen, firefox
windowrule = idleinhibit none,YouTube Music 

windowrule = float, class:com.github.wwmm.easyeffects
windowrule = float, class:myxer
# windowrulev2 = noborder, class:myxer
# windowrulev2 = move 70% 60%, class:myxer
#windowrulev2 = nomaxsize,xwayland:1
#windowrulev2 = nomaxsize,class:^(wine)$
#windowrulev2 = forceinput,xwayland:1
windowrulev2 = idleinhibit always,class:^(mpv)$
# }}}

# Dwindle {{{
dwindle {
  pseudotile = true
  preserve_split = true
  no_gaps_when_only = true
  # col.group_border_active = 0xff$cursor
  # col.group_border = 0x11$cursor
}
# }}}

# Monitor {{{
# monitor=DP-1,preferred,0x0,1 # Monitor
monitor=eDP-1,preferred,auto,1 # Laptop Screen
# }}}

# BlurLs List {{{
blurls=gtk-layer-shell
blurls=rofi
blurls=waybar
blurls=notifications
# }}}

 # Inputs {{{
input {
  repeat_rate=50
  repeat_delay=300
  touchpad {
    natural_scroll=true
    disable_while_typing=true
  }

  follow_mouse=1
  mouse_refocus=true

  float_switch_override_focus=1
  # follow_mouse=2
  sensitivity=0.6

  # device:wacom-one-by-wacom-s-pen {
  #   transform=1
  # }
}
device:opentabletdriver-virtual-mouse {
  enabled=1
  transform=1
}
# device:wacom-one-by-wacom-s-pen {
#     enabled=1
#     transform=1
# }

# }}}

# General {{{
general {
  layout=dwindle
# main_mod=SUPER
  gaps_in = 2
  gaps_out = 2
  border_size = 4
  no_cursor_warps = false
  apply_sens_to_raw = false
  resize_on_border = true
  col.active_border = 0xff$active
  col.inactive_border = 0x00$inactive
  col.group_border_active = 0xff$cursor
  col.group_border = 0x11$cursor
}

# }}}

# Decorations {{{
decoration {

  rounding=10
  multisample_edges = true
  fullscreen_opacity = 1.0

  # dim_inactive = true
  drop_shadow=true # enable drop shadows on windows
  shadow_range=36 # shadow range (in pixels), more = larger shadow
  # in what power to render the falloff (more power, the faster the falloff)
  shadow_render_power=2 # (1 - 4)
  # shadow_offset=5 5
  col.shadow = $background
  # col.shadow_inactive = $color4
  active_opacity=0.9
  inactive_opacity=0.8
  # # shadow settings
  # drop_shadow = true
  # shadow_ignore_window = true
  # shadow_offset = 2 2
  # shadow_range = 15
  # shadow_render_power = 2
  # col.shadow = 0x66000000

  # blur settings 

  blur = true
  blur_size = 6.8
  blur_passes = 2
  blur_ignore_opacity = true
  blur_new_optimizations = true
  # blur_xray = true

}
# }}}

# Animations {{{
animations {
  # enabled = true
  # # bezier curve
  # bezier = overshot, 0.05, 0.9, 0.1, 1.05
  # # bezier = overshot, 0.13, 0.99, 0.29, 1.1
  # bezier = smoothOut, 0.36, 0, 0.66, -0.56
  # bezier = smoothIn, 0.25, 1, 0.5, 1
  # # animation list
  # animation = windows, 1, 5, overshot, slide
  # animation = windowsOut, 1, 4, smoothOut, slide
  # animation = windowsMove, 1, 4, default
  # animation = border, 1, 10, default
  # animation = fade, 1, 10, smoothIn
  # animation = fadeDim, 1, 10, smoothIn
  # animation = workspaces, 1, 6, overshot, slide
  #

   # https://wiki.hyprland.org/Configuring/Animations/#animation-tree
    # https://cubic-bezier.com/

    # nice example: https://gitlab.com/eyssew/dotfiles/-/blob/main/forest-gruvbox-hyprland/hypr/animations.conf
    # bezier=overshot,0.13,0.99,0.29,1.1
    bezier=linear,0.3, 0.3, 0.7, 0.7
    # bezier=linear,0.3, 0.3, 1, 0.63
    bezier=easeinout,0.25, 0.1, 0.25, 1.0 # 0.42, 0.0, 0.58, 1.0
    bezier=ease,0.25, 0.1, 0.25, 1.0

    bezier = overshot, 0.05, 0.9, 0.1, 1.05
    bezier = smoothIn, 0.25, 1, 0.5, 1

    animation=windows,1,4,default,popin 60% # slide
    animation=windowsOut,1,2,default,popin 90% # slide
    animation=windowsMove,1,4,default

    # affects color change when switching between windows
    animation=border,1,9,default
    # animation=borderangle,1,39,linear,loop

    animation = fade, 1, 8, smoothIn
    animation = fadeSwitch, 1, 5, smoothIn
    animation = fadeDim, 1, 8, smoothIn

    # fade style is render-buggy for now, waiting till it gets better
    animation=workspaces,1,2,default,slide # slide / slidevert / fade
}
# }}}

# Gestures {{{
gestures {
  workspace_swipe=yes
  workspace_swipe_forever=true
}
# }}}

# Misc {{{
misc {
  layers_hog_keyboard_focus = true
  disable_hyprland_logo = true
  disable_splash_rendering = true
  mouse_move_enables_dpms = true
  animate_mouse_windowdragging=true
  animate_manual_resizes=true
  no_direct_scanout=true
  render_titles_in_groupbar=false
  enable_swallow=true
  swallow_regex=tmux
  swallow_regex=foot
  # render_ahead_of_time=true
  # render_ahead_safezone=1
  vfr=true
}

# Binds {{{
binds {
  allow_workspace_cycles = true
  focus_preferred_method=1
}
# }}}


# vim: set ft=conf: tabstop=2 softtabstop=2 shiftwidth=2 expandtab smarttab:
