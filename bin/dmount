#!/usr/bin/env bash
Dir="$HOME/mount/mtp"

check(){
  command -v $1 1>/dev/null
}

notify(){
  check notify-send && {
    notify-send "$@"
  } || echo "$@"
  return 0
}

check rofi || {
  notify "Rofi not available"
  exit 1
}

check simple-mtpfs || {
  notify "simple-mtpfs not available"
  exit 1
}

check fusermount || {
  notify "fusermount not available"
  exit 1
}

# Make the cell directory if it doesn't exist
[ -d "$Dir" ] || mkdir -p "$Dir"

# Select device
Devices=$(simple-mtpfs -l)

[ -z "$Devices" ] && {
  notify "No Devices found" -i "smartphone"
  exit
}

Device=$(echo "$Devices" | rofi -dmenu -p "Select device:")

Id=${Device%%:*}
Name=$(echo "${Device##*: }" | sed 's/ /-/g' | sed 's/[()]//g')

[ -d "$Dir/$Name" ] || mkdir -p "$Dir/$Name"

[ -z "$(find "$Dir/$Name" -maxdepth 0 -empty)" ] && {
  fusermount -u "$Dir/$Name" && notify "Android Mount" "Device Unmounted" -i "smartphone"
  exit
}
simple-mtpfs --device "$Id" "$Dir/$Name" && notify "Android Mount" "Device Mounted in $Dir/$Name" -i "smartphone"

